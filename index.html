<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>俄罗斯方块</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{background:#0a0a1a;color:#fff;font-family:'Segoe UI',sans-serif;display:flex;justify-content:center;align-items:center;min-height:100vh;overflow:hidden}
#game-wrap{display:flex;flex-direction:column;align-items:center;gap:12px}
#top-bar{display:flex;gap:20px;font-size:14px;text-transform:uppercase;letter-spacing:2px}
#top-bar span{color:#888}
#top-bar b{color:#0ff;font-size:18px}
#main{display:flex;gap:16px;align-items:flex-start}
canvas{border:2px solid #1a1a3a;border-radius:6px;background:#0d0d20}
#side{display:flex;flex-direction:column;gap:12px}
#next-label{font-size:12px;color:#666;text-align:center;letter-spacing:2px}
#controls{display:grid;grid-template-columns:repeat(3,56px);grid-template-rows:repeat(2,56px);gap:6px;margin-top:16px}
.btn{background:#1a1a3a;border:1px solid #2a2a5a;border-radius:10px;color:#0ff;font-size:22px;display:flex;align-items:center;justify-content:center;cursor:pointer;user-select:none;transition:background .1s}
.btn:active{background:#2a2a6a}
#btn-up{grid-column:2}
#btn-left{grid-column:1;grid-row:2}
#btn-down{grid-column:2;grid-row:2}
#btn-right{grid-column:3;grid-row:2}
#btn-drop{margin-top:8px;padding:12px;font-size:16px;letter-spacing:4px;grid-column:1/4}
#overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.85);display:none;justify-content:center;align-items:center;flex-direction:column;gap:20px;z-index:10}
#overlay.show{display:flex}
#overlay h1{font-size:32px;color:#f44}
#overlay p{font-size:20px;color:#ccc}
#overlay button{padding:12px 36px;font-size:18px;background:#0ff;color:#000;border:none;border-radius:8px;cursor:pointer;font-weight:bold}
#overlay button:hover{background:#0dd}
#start-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);display:flex;justify-content:center;align-items:center;flex-direction:column;gap:20px;z-index:10}
#start-overlay h1{font-size:36px;background:linear-gradient(90deg,#0ff,#f0f);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
#start-overlay button{padding:14px 40px;font-size:20px;background:linear-gradient(135deg,#0ff,#08f);color:#000;border:none;border-radius:8px;cursor:pointer;font-weight:bold}
</style>
</head>
<body>
<div id="start-overlay"><h1>俄罗斯方块</h1><button onclick="startGame()">开始游戏</button></div>
<div id="overlay"><h1>游戏结束</h1><p id="final-score"></p><button onclick="startGame()">再来一局</button></div>
<div id="game-wrap">
  <div id="top-bar">
    <div>分数 <b id="score">0</b></div>
    <div>等级 <b id="level">1</b></div>
    <div>行数 <b id="lines">0</b></div>
  </div>
  <div id="main">
    <canvas id="board" width="240" height="480"></canvas>
    <div id="side">
      <div id="next-label">下一个</div>
      <canvas id="next" width="100" height="100"></canvas>
      <div id="controls">
        <div class="btn" id="btn-up" ontouchstart="e(event);input('up')" onmousedown="input('up')">▲</div>
        <div class="btn" id="btn-left" ontouchstart="e(event);input('left')" onmousedown="input('left')">◀</div>
        <div class="btn" id="btn-down" ontouchstart="e(event);input('down')" onmousedown="input('down')">▼</div>
        <div class="btn" id="btn-right" ontouchstart="e(event);input('right')" onmousedown="input('right')">▶</div>
        <div class="btn" id="btn-drop" ontouchstart="e(event);input('drop')" onmousedown="input('drop')">落下</div>
      </div>
    </div>
  </div>
</div>
<script>
function e(ev){ev.preventDefault()}
const COLS=10,ROWS=20,SZ=24,ctx=document.getElementById('board').getContext('2d'),nctx=document.getElementById('next').getContext('2d');
const COLORS=['','#00f0f0','#f0f000','#a000f0','#00f000','#f00000','#0000f0','#f0a000'];
const GRAD=[['#00f0f0','#008888'],['#f0f000','#888800'],['#a000f0','#600090'],['#00f000','#008800'],['#f00000','#880000'],['#0000f0','#000088'],['#f0a000','#886000']];
const SHAPES=[
  [[1,1,1,1]],
  [[1,1],[1,1]],
  [[0,1,0],[1,1,1]],
  [[0,1,1],[1,1,0]],
  [[1,1,0],[0,1,1]],
  [[1,0,0],[1,1,1]],
  [[0,0,1],[1,1,1]]
];
let board,piece,nextPiece,pos,score,lines,level,timer,gameOver,paused=false;
function newBoard(){return Array.from({length:ROWS},()=>new Array(COLS).fill(0))}
function randPiece(){const i=Math.floor(Math.random()*7);return{shape:SHAPES[i],color:i+1}}
function rotate(s){const r=s[0].length,c=s.length;const n=Array.from({length:r},()=>new Array(c).fill(0));for(let y=0;y<c;y++)for(let x=0;x<r;x++)n[x][c-1-y]=s[y][x];return n}
function valid(shape,px,py){for(let y=0;y<shape.length;y++)for(let x=0;x<shape[y].length;x++)if(shape[y][x]){const nx=px+x,ny=py+y;if(nx<0||nx>=COLS||ny>=ROWS||(ny>=0&&board[ny][nx]))return false}return true}
function merge(){piece.shape.forEach((r,y)=>r.forEach((v,x)=>{if(v&&pos.y+y>=0)board[pos.y+y][pos.x+x]=piece.color}))}
function clearLines(){let cleared=0;for(let y=ROWS-1;y>=0;y--){if(board[y].every(c=>c)){board.splice(y,1);board.unshift(new Array(COLS).fill(0));cleared++;y++}}if(cleared){lines+=cleared;score+=[0,100,300,500,800][cleared]*level;level=Math.floor(lines/10)+1;updateHUD();clearInterval(timer);timer=setInterval(tick,Math.max(100,600-50*(level-1)))}}
function updateHUD(){document.getElementById('score').textContent=score;document.getElementById('level').textContent=level;document.getElementById('lines').textContent=lines}
function drawBlock(c,x,y,s,sz){const g=c.createLinearGradient(x,y,x+sz,y+sz);g.addColorStop(0,GRAD[s-1][0]);g.addColorStop(1,GRAD[s-1][1]);c.fillStyle=g;c.fillRect(x+1,y+1,sz-2,sz-2);c.strokeStyle='rgba(255,255,255,0.1)';c.strokeRect(x+1,y+1,sz-2,sz-2)}
function draw(){ctx.clearRect(0,0,240,480);for(let y=0;y<ROWS;y++)for(let x=0;x<COLS;x++){if(board[y][x])drawBlock(ctx,x*SZ,y*SZ,board[y][x],SZ);else{ctx.fillStyle='#0d0d20';ctx.fillRect(x*SZ,y*SZ,SZ,SZ);ctx.strokeStyle='#151530';ctx.strokeRect(x*SZ,y*SZ,SZ,SZ)}}
// ghost
let gy=pos.y;while(valid(piece.shape,pos.x,gy+1))gy++;if(gy!==pos.y)piece.shape.forEach((r,dy)=>r.forEach((v,dx)=>{if(v&&gy+dy>=0){ctx.fillStyle='rgba(255,255,255,0.08)';ctx.fillRect((pos.x+dx)*SZ+1,(gy+dy)*SZ+1,SZ-2,SZ-2)}}));
piece.shape.forEach((r,dy)=>r.forEach((v,dx)=>{if(v&&pos.y+dy>=0)drawBlock(ctx,(pos.x+dx)*SZ,(pos.y+dy)*SZ,piece.color,SZ)}));
// next
nctx.clearRect(0,0,100,100);const ns=nextPiece.shape,ox=Math.floor((100-ns[0].length*20)/2),oy=Math.floor((100-ns.length*20)/2);ns.forEach((r,dy)=>r.forEach((v,dx)=>{if(v)drawBlock(nctx,ox+dx*20,oy+dy*20,nextPiece.color,20)}))}
function spawn(){piece=nextPiece;nextPiece=randPiece();pos={x:Math.floor((COLS-piece.shape[0].length)/2),y:-piece.shape.length};if(!valid(piece.shape,pos.x,pos.y+1)){merge();draw();gameOver=true;clearInterval(timer);document.getElementById('final-score').textContent='最终得分：'+score;document.getElementById('overlay').classList.add('show')}}
function tick(){if(gameOver||paused)return;if(valid(piece.shape,pos.x,pos.y+1)){pos.y++}else{merge();clearLines();spawn()}draw()}
function input(dir){if(gameOver||paused)return;if(dir==='left'&&valid(piece.shape,pos.x-1,pos.y))pos.x--;else if(dir==='right'&&valid(piece.shape,pos.x+1,pos.y))pos.x++;else if(dir==='down'){if(valid(piece.shape,pos.x,pos.y+1))pos.y++;else{merge();clearLines();spawn()}}else if(dir==='up'){const r=rotate(piece.shape);if(valid(r,pos.x,pos.y))piece.shape=r;else if(valid(r,pos.x-1,pos.y)){piece.shape=r;pos.x--}else if(valid(r,pos.x+1,pos.y)){piece.shape=r;pos.x++}}else if(dir==='drop'){while(valid(piece.shape,pos.x,pos.y+1))pos.y++;merge();clearLines();spawn()}draw()}
document.addEventListener('keydown',ev=>{const map={ArrowLeft:'left',ArrowRight:'right',ArrowDown:'down',ArrowUp:'up',' ':'drop'};if(map[ev.key]){ev.preventDefault();input(map[ev.key])}});
function startGame(){document.getElementById('start-overlay').style.display='none';document.getElementById('overlay').classList.remove('show');board=newBoard();score=0;lines=0;level=1;gameOver=false;updateHUD();nextPiece=randPiece();spawn();clearInterval(timer);timer=setInterval(tick,600);draw()}
</script>
</body>
</html>
